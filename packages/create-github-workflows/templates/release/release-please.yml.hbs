name: Release Please

on:
  push:
    branches:
      - main
  workflow_dispatch:

permissions:
  contents: write
  pull-requests: write

jobs:
  release-please:
    runs-on: ubuntu-latest
    steps:
      - name: Run release-please
        id: release
        uses: googleapis/release-please-action@v4
        with:
          # PAT with contents: write permission. This way, tags created will trigger other workflows.
          # GITHUB_TOKEN does not trigger other workflows
          token: $\{{ secrets.RELEASE_PAT }}
          config-file: release-please-config.json
          manifest-file: .release-please-manifest.json

      - name: Log release info
        if: $\{{ steps.release.outputs.release_created }}
        run: |
          echo "Release created: $\{{ steps.release.outputs.tag_name }}"

# ═══════════════════════════════════════════════════════════
# Setup Instructions
# ═══════════════════════════════════════════════════════════
#
# 1. Create release-please-config.json:
#    {
#      "packages": {
#        ".": {}
#      },
#      "$schema": "https://raw.githubusercontent.com/googleapis/release-please/main/schemas/config.json"
#    }
#
# 2. Create .release-please-manifest.json:
#    {
#      ".": "0.0.0"
#    }
#
# 3. Create RELEASE_PAT secret:
#    - Go to GitHub Settings → Developer settings → Personal access tokens
#    - Create token with 'contents: write' permission
#    - Add as repository secret named RELEASE_PAT
#
# 4. Follow Conventional Commits:
#    - feat: triggers minor version bump
#    - fix: triggers patch version bump
#    - feat!: or BREAKING CHANGE: triggers major version bump
